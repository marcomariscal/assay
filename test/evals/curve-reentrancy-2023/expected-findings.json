{
  "exploit": {
    "name": "Curve Finance Vyper reentrancy bug (alETH/msETH/pETH)",
    "date": "2023-07-30",
    "loss": "$70M",
    "chains": ["ethereum"],
    "reference": "https://hackmd.io/@LlamaRisk/BJzSKHNjn"
  },
  "expectedFindings": [
    {
      "code": "REENTRANCY_GUARD_BYPASS",
      "level": "danger",
      "pattern": "@nonreentrant ineffective in vulnerable Vyper versions",
      "location": "remove_liquidity"
    },
    {
      "code": "EXTERNAL_CALL_BEFORE_STATE_UPDATE",
      "level": "danger",
      "pattern": "raw_call/send occurs before balance decrement",
      "location": "_unsafe_transfer"
    }
  ],
  "aiExpectedConcerns": [
    {
      "category": "reentrancy",
      "severity": "high",
      "title": "Broken Vyper nonreentrant guard enables reentry during ETH transfer",
      "minConfidence": 80
    }
  ],
  "attackVector": {
    "description": "Attacker reenters during ETH transfer to withdraw multiple times despite @nonreentrant.",
    "steps": [
      "Call remove_liquidity on a vulnerable pool",
      "Reenter via fallback during raw_call/send",
      "Withdraw again before balance is updated",
      "Repeat to drain pool"
    ]
  }
}
